From 2d0e8fbe6c1ea80f3d57fe19c5b98e6939f4c2b9 Mon Sep 17 00:00:00 2001
From: joaopa <jeremielapuree@yahoo.fr>
Date: Sun, 6 Mar 2022 10:08:26 -1000
Subject: [PATCH] [FR - L'EQUIPE] Add additional lives

Live channels 1,2 and 3 are missing
---
 addon.xml                                     |  1 +
 .../resource.language.en_gb/strings.po        |  4 +++
 .../resource.language.fr_fr/strings.po        |  5 ++++
 .../resource.language.he_il/strings.po        |  4 +++
 .../resource.language.nl_nl/strings.po        |  4 +++
 resources/lib/channels/fr/lequipe.py          | 28 ++++++++++---------
 resources/lib/skeletons/fr_live.py            | 25 ++++++++++++++++-
 resources/settings.xml                        |  3 ++
 8 files changed, 60 insertions(+), 14 deletions(-)

diff --git a/addon.xml b/addon.xml
index 6b255ed2..a9e4e083 100644
--- a/addon.xml
+++ b/addon.xml
@@ -44,6 +44,7 @@
     <news>
 [Version 0.2.38]
 [IT - Radiofreccia] Add Radiofreccia Web TV (PR #675) Thanks @darodi
+[FR - LEQUIPE] Add additional lives (issue #481)
 ----
 Visit WebSite - http://mpdb.tv/#home which host the french forum used by users of CU TV and More
     </news>
diff --git a/resources/language/resource.language.en_gb/strings.po b/resources/language/resource.language.en_gb/strings.po
index a633444c..f4f0a9b1 100644
--- a/resources/language/resource.language.en_gb/strings.po
+++ b/resources/language/resource.language.en_gb/strings.po
@@ -379,6 +379,10 @@ msgctxt "#30173"
 msgid "TV5 monde plus: Choose language"
 msgstr ""
 
+msgctxt "#30174"
+msgid "L\'Equipe: Choose live channel"
+msgstr ""
+
 
 # Download (from 30200 to 30239)
 
diff --git a/resources/language/resource.language.fr_fr/strings.po b/resources/language/resource.language.fr_fr/strings.po
index c26b6a00..12993f01 100644
--- a/resources/language/resource.language.fr_fr/strings.po
+++ b/resources/language/resource.language.fr_fr/strings.po
@@ -379,6 +379,11 @@ msgctxt "#30173"
 msgid "TV5 monde plus: Choose language"
 msgstr "TV5 monde plus: Choix du langage"
 
+msgctxt "#30174"
+msgid "L\'Equipe: Choose live channel"
+msgstr "L'Equipe: Choix du direct"
+
+
 # Download (from 30200 to 30239)
 
 msgctxt "#30200"
diff --git a/resources/language/resource.language.he_il/strings.po b/resources/language/resource.language.he_il/strings.po
index ec6986bc..1c4eb69e 100644
--- a/resources/language/resource.language.he_il/strings.po
+++ b/resources/language/resource.language.he_il/strings.po
@@ -379,6 +379,10 @@ msgctxt "#30173"
 msgid "TV5 monde plus: Choose language"
 msgstr ""
 
+msgctxt "#30174"
+msgid "L\'Equipe: Choose live channel"
+msgstr ""
+
 
 # Download (from 30200 to 30239)
 
diff --git a/resources/language/resource.language.nl_nl/strings.po b/resources/language/resource.language.nl_nl/strings.po
index 970d5464..f0a5d77c 100644
--- a/resources/language/resource.language.nl_nl/strings.po
+++ b/resources/language/resource.language.nl_nl/strings.po
@@ -379,6 +379,10 @@ msgctxt "#30173"
 msgid "TV5 monde plus: Choose language"
 msgstr ""
 
+msgctxt "#30174"
+msgid "L\'Equipe: Choose live channel"
+msgstr ""
+
 
 # Download (from 30200 to 30239)
 
diff --git a/resources/lib/channels/fr/lequipe.py b/resources/lib/channels/fr/lequipe.py
index 059e3173..34a0208e 100644
--- a/resources/lib/channels/fr/lequipe.py
+++ b/resources/lib/channels/fr/lequipe.py
@@ -9,7 +9,7 @@ from builtins import str
 import json
 import re
 
-from codequick import Listitem, Resolver, Route
+from codequick import Listitem, Resolver, Route, Script
 import urlquick
 
 from resources.lib import resolver_proxy, web_utils
@@ -27,6 +27,11 @@ URL_INFO_STREAM_LIVE = URL_ROOT + '/js/app.%s.js'
 
 URL_API_LEQUIPE = URL_ROOT + '/equipehd/applis/filtres/videosfiltres.json'
 
+# TODO Channels 1,2 and 3 are missing
+ADDITIONAL_LIVES = ['k5TgcOKBUTM2KnqwBWC', 'kXRfcKHV9HhcZuqwBYP', 'k6oih7JyuEmhrnqwBZT', 'k3HiS3JB0BsORKqwC49', 'k6P3xLH5tTtGSgqwC4P',
+                    'k1y3Q3GC7w8flQry8S3', 'k5VKYQn5hAE4vfry927', 'k2Z9T8IhyLWvyPtITYJ', 'k53cYSxIs49Vf0wkv86', 'k7rZDp22dyZ25EwkvsF',
+                    'k6c3A07yUljlAzwkvtL']
+
 
 @Route.register
 def list_programs(plugin, item_id, **kwargs):
@@ -81,22 +86,19 @@ def list_videos(plugin, item_id, program_url, page, **kwargs):
 
 
 @Resolver.register
-def get_video_url(plugin,
-                  item_id,
-                  video_id,
-                  download_mode=False,
-                  **kwargs):
+def get_video_url(plugin, item_id, video_id, download_mode=False, **kwargs):
 
-    return resolver_proxy.get_stream_dailymotion(plugin, video_id,
-                                                 download_mode)
+    return resolver_proxy.get_stream_dailymotion(plugin, video_id, download_mode)
 
 
 @Resolver.register
 def get_live_url(plugin, item_id, **kwargs):
 
-    resp = urlquick.get(URL_LIVE,
-                        headers={'User-Agent': web_utils.get_random_ua()},
-                        max_age=-1)
-    live_id = re.compile(r'video-id\=\"(.*?)\"',
-                         re.DOTALL).findall(resp.text)[0]
+    if item_id == 'lequipesup':
+        live = kwargs.get('language', Script.setting["lequipesup.language"])
+        live_id = ADDITIONAL_LIVES[int(re.findall("\d+", live)[0]) - 4]
+    else:
+        resp = urlquick.get(URL_LIVE, headers={'User-Agent': web_utils.get_random_ua()}, max_age=-1)
+        live_id = re.compile(r'video-id\=\"(.*?)\"', re.DOTALL).findall(resp.text)[0]
+
     return resolver_proxy.get_stream_dailymotion(plugin, live_id, False)
diff --git a/resources/lib/skeletons/fr_live.py b/resources/lib/skeletons/fr_live.py
index e663ba18..83a11814 100644
--- a/resources/lib/skeletons/fr_live.py
+++ b/resources/lib/skeletons/fr_live.py
@@ -985,5 +985,28 @@ menu = {
         'm3u_group': 'Satellite/FAI',
         'enabled': True,
         'order': 139
-    }
+    },
+    'lequipesup': {
+        'resolver': '/resources/lib/channels/fr/lequipe:get_live_url',
+        'label': 'L\'Equipe (DIRECTs)',
+        'thumb': 'channels/fr/lequipe.png',
+        'fanart': 'channels/fr/lequipe_fanart.png',
+        'm3u_group': 'Région',
+        'available_languages': {
+            "Direct 4": {},
+            "Direct 5": {},
+            "Direct 6": {},
+            "Direct 7": {},
+            "Direct 8": {},
+            "Direct 9": {},
+            "Direct 10": {},
+            "Direct 11": {},
+            "Direct 12": {},
+            "Direct 13": {},
+            "Direct 14": {},
+            "Direct 15": {},
+        },
+        'enabled': True,
+        'order': 140
+    },
 }
diff --git a/resources/settings.xml b/resources/settings.xml
index c049f18d..dd67e91a 100644
--- a/resources/settings.xml
+++ b/resources/settings.xml
@@ -61,6 +61,9 @@
                 <setting label="30158" type="labelenum" id="france3regions.language" values="Alpes|Alsace|Aquitaine|Auvergne|Bourgogne|Bretagne|Centre-Val de Loire|Chapagne-Ardenne|Corse|Côte d'Azur|Franche-Comté|Languedoc-Roussillon|Limousin|Lorraine|Midi-Pyrénées|Nord-Pas-de-Calais|Basse-Normandie|Haute-Normandie|Paris Île-de-France|Pays de la Loire|Picardie|Poitou-Charentes|Provence-Alpes|Rhône-Alpes|Nouvelle-Aquitaine" default="Alpes"/>
                 <setting label="30159" type="labelenum" id="la_1ere.language" values="Guadeloupe|Guyane|Martinique|Mayotte|Nouvelle Calédonie|Polynésie|Réunion|St-Pierre et Miquelon|Wallis et Futuna|Outre-mer" default="Guadeloupe"/>
                 <setting label="30171" type="labelenum" id="BFM_Régions.language" values="BFM DICI HAUTE-PROVENCE|BFM Grand Lille|BFM Grand Littoral|BFM Lyon|BFM MARSEILLE PROVENCE|BFM NICE COTE D'AZUR|BFM Paris|BFM TOULON VAR" default="BFM Paris"/>
+                <setting label="30174" type="labelenum" id="lequipesup.language" values="Direct 4|Direct 5|Direct 6l|Direct 6|Direct 7|Direct 8|
+                                                                                        Direct 9|Direct 10|Direct 11|Direct 12|Direct 13|Direct 14|
+                                                                                        Direct 15" default="Direct 4"/>
 
             <!-- Spain channels -->
             <setting label="30089" type="lsep" subsetting="true" visible="eq(1,true)"/>
-- 
2.32.0

